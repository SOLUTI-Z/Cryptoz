<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CryptoZ — Carteira Inteligente</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #ticker {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 9999;
      font-size: 0.9rem;
    }
    #ticker-content {
      animation: deslizar 30s linear infinite;
      white-space: nowrap;
    }
    @keyframes deslizar {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    body {
      padding-top: 40px;
    }
  </style>
</head>
<body>

<!-- 🔹 Ticker rotativo -->
<div id="ticker" class="bg-dark text-light py-2 px-3 overflow-hidden">
  <div id="ticker-content" class="d-inline-block"></div>
</div>

<!-- 🔹 Botão menu lateral -->
<button class="btn btn-secondary position-fixed top-0 start-0 m-3" data-bs-toggle="offcanvas" data-bs-target="#menuSidebar" aria-controls="menuSidebar">☰ Menu</button>

<!-- 🔹 Painel principal -->
<div id="painel" class="container py-4">
  <h2 class="mb-4">💼 Minha Carteira</h2>

  <!-- 🔹 Seção: Aportar -->
  <section id="secaoAporte" class="my-5">
    <h4>📥 Novo Aporte</h4>
    <form id="formMoeda" class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Nome da Moeda</label>
        <input type="text" class="form-control" id="nomeMoeda" required />
      </div>
      <div class="col-md-4">
        <label class="form-label">Quantidade</label>
        <input type="number" class="form-control" id="quantidadeMoeda" required />
      </div>
      <div class="col-md-4">
        <label class="form-label">Preço Unitário</label>
        <input type="number" step="0.01" class="form-control" id="precoMoeda" required />
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary">Adicionar</button>
      </div>
    </form>
  </section>

  <!-- 🔹 Seção: Portfólio -->
  <section id="secaoPortfolio" class="my-5">
    <h4>📊 Portfólio de Criptos</h4>
    <div id="tabelaMoedas"></div>
  </section>

  <!-- 🔹 Seção: Cripto Scan -->
  <section id="secaoCriptoScan" class="my-5">
    <h4>🧠 Cripto Scan — Radar de Oportunidades</h4>
    <p class="text-muted">
      O Cripto Scan analisa ativos em tempo real para identificar oportunidades de compra ou venda com base em tendências, volatilidade e comportamento de mercado. Uma ferramenta estratégica para agir com mais precisão e segurança.
    </p>
    <div class="mt-4">
      <h6>🔎 Ativos em Destaque</h6>
      <div id="scanResultados" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 mt-2"></div>
    </div>
  </section>
</div>

<!-- 🔹 Menu lateral -->
<div class="offcanvas offcanvas-start bg-dark text-light" tabindex="-1" id="menuSidebar" aria-labelledby="menuSidebarLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">📂 Navegação</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body d-grid gap-2">
    <button class="btn btn-outline-light w-100" onclick="scrollToSection('secaoAporte')">📥 Aportar</button>
    <button class="btn btn-outline-light w-100" onclick="scrollToSection('secaoPortfolio')">📊 Portfólio</button>
    <button class="btn btn-outline-light w-100" onclick="scrollToSection('secaoCriptoScan')">🧠 Cripto Scan</button>
    <hr class="text-secondary">
    <button class="btn btn-outline-warning w-100" onclick="toggleDarkMode()">🌓 Alternar Tema</button>
    <div class="input-group mt-3">
      <input type="file" class="form-control" id="arquivoImportar">
      <button class="btn btn-outline-info" onclick="importarBackup()">⬆️ Importar</button>
    </div>
    <button class="btn btn-outline-success w-100 mt-2" onclick="exportarBackup()">⬇️ Exportar</button>
  </div>
</div>

<!-- 🔹 Scripts principais -->
<script>
// Cadastro
let moedas = [];
document.getElementById("formMoeda").addEventListener("submit", function (e) {
  e.preventDefault();
  const nome = document.getElementById("nomeMoeda").value;
  const quantidade = parseFloat(document.getElementById("quantidadeMoeda").value);
  const preco = parseFloat(document.getElementById("precoMoeda").value);
  if (!nome || isNaN(quantidade) || isNaN(preco)) return;
  moedas.push({ nome, quantidade, preco });
  atualizarTabela();
  salvarBackup();
  this.reset();
});

function atualizarTabela() {
  const tabela = document.getElementById("tabelaMoedas");
  if (!moedas.length) {
    tabela.innerHTML = '<div class="alert alert-warning">Nenhuma moeda cadastrada.</div>';
    return;
  }
  let total = 0;
  tabela.innerHTML = `
    <table class="table table-striped">
      <thead><tr><th>Moeda</th><th>Quantidade</th><th>Preço Unitário</th><th>Total</th></tr></thead>
      <tbody>
        ${moedas.map(m => {
          const valor = m.quantidade * m.preco;
          total += valor;
          return `<tr><td>${m.nome}</td><td>${m.quantidade}</td><td>R$ ${m.preco.toFixed(2)}</td><td>R$ ${valor.toFixed(2)}</td></tr>`;
        }).join("")}
      </tbody>
      <tfoot><tr class="fw-bold"><td colspan="3">Total investido</td><td>R$ ${total.toFixed(2)}</td></tr></tfoot>
    </table>`;
}

// Backup e modo escuro
function exportarBackup() {
  const blob = new Blob([JSON.stringify(moedas)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = "cryptoZ_backup.json";
  link.click();
  URL.revokeObjectURL(url);
}
function importarBackup() {
  const file = document.getElementById("arquivoImportar").files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      moedas = JSON.parse(e.target.result);
      atualizarTabela();
      salvarBackup();
    } catch {
      alert("Arquivo inválido.");
    }
  };
  reader.readAsText(file);
}
function toggleDarkMode() {
  document.body.classList.toggle("bg-dark");
  document.body.classList.toggle("text-light");
}
function salvarBackup() {
  localStorage.setItem("cryptoZ_dados", JSON.stringify(moedas));
}
function scrollToSection(id) {
  const target = document.getElementById(id);
  if (target) {
    const yOffset = -30;
    const y = target.getBoundingClientRect().top + window.scrollY + yOffset;
    window.scrollTo({ top: y, behavior: "smooth" });
  }
}
window.addEventListener("load", () => {
  const dados = localStorage.getItem("cryptoZ_dados");
  if (dados) {
    moedas = JSON.parse(dados);
    atualizarTabela();
  }
  carregarTicker();
  carregarCriptoScan();
});

// Ticker CoinGecko
async function carregarTicker() {
  const moedas = ["bitcoin", "ethereum", "tether", "usd", "real"];
  const nomes = { bitcoin: "BTC", ethereum: "ETH", tether: "USDT", usd: "USD",
